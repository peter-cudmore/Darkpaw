#include <math.h>
#include "model.h"
#include "types.h"
#include "linalg.h"

 AngleLookupTable BodyMotor = {
        .size = 270,
        .entries = {
            {230, -0.24825089657589883, 0.002479947715431408},
            {231, -0.24819277231199405, 0.007375313476900931},
            {232, -0.2480774067697772, 0.012282744116118557},
            {233, -0.24790526062477125, 0.017198963883030195},
            {234, -0.24767680241057732, 0.022120781503407138},
            {235, -0.2473925080766858, 0.027045090609234535},
            {236, -0.24705286422332506, 0.03196886930396361},
            {237, -0.24665835300932754, 0.03688918307157125},
            {238, -0.24620947375720928, 0.04180318044686776},
            {239, -0.24570672787271555, 0.0467080957038681},
            {240, -0.2451506221281325, 0.05160124779157839},
            {241, -0.2445416682851245, 0.05648003987560835},
            {242, -0.24388038272849577, 0.06134195876299022},
            {243, -0.24316728611083901, 0.06618457421856706},
            {244, -0.24240290300802184, 0.07100553818106706},
            {245, -0.24158776158544037, 0.07580258388671118},
            {246, -0.24072239327495495, 0.08057352490793397},
            {247, -0.2398073324624094, 0.08531625411451503},
            {248, -0.23884311618561763, 0.09002874256414108},
            {249, -0.2378302838426952, 0.09470903832912665},
            {250, -0.236769376910596, 0.09935526526574266},
            {251, -0.23566093867370771, 0.10396562173230645},
            {252, -0.23450551396235012, 0.10853837926190456},
            {253, -0.23330364890101007, 0.11307188119533955},
            {254, -0.23205589075019173, 0.11756454127748968},
            {255, -0.23076278747732215, 0.12201484223312957},
            {256, -0.2294248876214456, 0.1264213343058397},
            {257, -0.2280427401545986, 0.1307826337811766},
            {258, -0.2266168942239646, 0.13509742149661091},
            {259, -0.22514789895471288, 0.13936444133774115},
            {260, -0.22363630326125908, 0.14358249872625717},
            {261, -0.22208265566674634, 0.14775045910314868},
            {262, -0.22048750413054002, 0.15186724641041657},
            {263, -0.21885139588353517, 0.1559318415743301},
            {264, -0.21717487727106632, 0.15994328099304939},
            {265, -0.21545849360322036, 0.16390065503123113},
            {266, -0.21370278901233847, 0.1678031065240339},
            {267, -0.2119083063175108, 0.17164982929275116},
            {268, -0.2100755868958547, 0.1754400666741148},
            {269, -0.2082051705603746, 0.17917311006514045},
            {270, -0.20629759544420567, 0.18284829748522002},
            {271, -0.2043533978910392, 0.18646501215700662},
            {272, -0.20237311235153402, 0.19002268110749104},
            {273, -0.20035727128552047, 0.19352077379052182},
            {274, -0.1983064052458613, 0.1969588007540691},
            {275, -0.19622104209579036, 0.20033631222246567},
            {276, -0.19410170795909906, 0.20365289691578664},
            {277, -0.19194892646355755, 0.20690818068601022},
            {278, -0.18976321883740244, 0.2101018252811498},
            {279, -0.18754510384237288, 0.21323352711575835},
            {280, -0.18529509771126104, 0.2163030160682895},
            {281, -0.183013714089809, 0.21931005430568876},
            {282, -0.1807014639827854, 0.22225443513550236},
            {283, -0.17835885570408194, 0.22513598188572242},
            {284, -0.17598639483066839, 0.2279545468125053},
            {285, -0.1735845841602558, 0.23071001003584937},
            {286, -0.17115392367251323, 0.23340227850324247},
            {287, -0.16869491049369395, 0.23603128498124207},
            {288, -0.16620803886452654, 0.23859698707489757},
            {289, -0.16369380011123222, 0.24109936627487571},
            {290, -0.16115268261953072, 0.24353842703210607},
            {291, -0.15858517181150714, 0.245914195859725},
            {292, -0.15599175012520525, 0.24822672046205946},
            {293, -0.15337289699682793, 0.2504760688903585},
            {294, -0.15072908884542122, 0.2526623287249525},
            {295, -0.14806079905992406, 0.25478560628349},
            {296, -0.14536849798847018, 0.2568460258548829},
            {297, -0.1426526529298333, 0.258843728958563},
            {298, -0.13991372812690525, 0.2607788736286399},
            {299, -0.1371521842305024, 0.2626516335733405},
            {300, -0.1343684803853039, 0.2644621980906518},
            {301, -0.1315630711654132, 0.26621077057415904},
            {302, -0.12873640854856003, 0.26789756843717594},
            {303, -0.12588894146459095, 0.2695228223903422},
            {304, -0.12302111578548607, 0.2710867758619269},
            {305, -0.12013337433035289, 0.27258968444360887},
            {306, -0.11722615687171113, 0.2740318153574277},
            {307, -0.11429990014299089, 0.2754134469434068},
            {308, -0.11135503774767887, 0.27673486813452264},
            {309, -0.10839200058016588, 0.2779963781194207},
            {310, -0.10541121619850631, 0.27919828568004784},
            {311, -0.10241310927647901, 0.28034090890071106},
            {312, -0.09939810150187309, 0.28142457471454685},
            {313, -0.0963666115897466, 0.2824496185047657},
            {314, -0.09331905529641751, 0.28341638372310934},
            {315, -0.09025584543412521, 0.2843252215250332},
            {316, -0.08717739188630931, 0.2851764904211435},
            {317, -0.08408410162471916, 0.2859705559448848},
            {318, -0.08097637872157458, 0.2867077903334884},
            {319, -0.07785462437095757, 0.2873885722270342},
            {320, -0.0747192369044157, 0.28801328637960727},
            {321, -0.07157061180846601, 0.28858232338495304},
            {322, -0.06840914174249174, 0.28909607941565413},
            {323, -0.06523521655691547, 0.28955495597536357},
            {324, -0.06204922331160448, 0.28995935966366476},
            {325, -0.05885154629447342, 0.29030970195314026},
            {326, -0.05564256704024171, 0.2906063989782267},
            {327, -0.05242266434931328, 0.2908498713354594},
            {328, -0.04919221430674241, 0.29104054389469575},
            {329, -0.045951590301253425, 0.29117884562093577},
            {330, -0.04270116304428163, 0.2912652094063486},
            {331, -0.03944130058900676, 0.29130007191213103},
            {332, -0.03617236834935041, 0.2912838734198295},
            {333, -0.032894729150455986, 0.2912170577061871},
            {334, -0.02960874310737946, 0.29110007184831566},
            {335, -0.026314767879992772, 0.29093336620891036},
            {336, -0.02301315850896272, 0.2907173942388233},
            {337, -0.019704267501678148, 0.29045261240126147},
            {338, -0.016388444869264038, 0.2901394800818923},
            {339, -0.013066038017605789, 0.28977845943566716},
            {340, -0.009737391742617013, 0.2893700152880566},
            {341, -0.0064028489062802445, 0.2889146153799259},
            {342, -0.003062749350841024, 0.28841272975531107},
            {343, 0.0002825693193330749, 0.28786483106775823},
            {344, 0.0036327719239188532, 0.28727139442035216},
            {345, 0.006987525689755468, 0.286632897309991},
            {346, 0.010346500234311239, 0.28594981957670584},
            {347, 0.013709367540978236, 0.28522264336224157},
            {348, 0.017075801950349204, 0.2844518530651349},
            {349, 0.020445480169093748, 0.2836379352906594},
            {350, 0.0238180812223663, 0.28278137883474613},
            {351, 0.02719328644990418, 0.2818826746490686},
            {352, 0.030570779492033767, 0.2809423158151235},
            {353, 0.0339502462760399, 0.2799607975216419},
            {354, 0.03733137500290097, 0.2789386170451053},
            {355, 0.04071385613440123, 0.27787627373315493},
            {356, 0.04409738238062334, 0.27677426899066904},
            {357, 0.04748164868779843, 0.27563310626832327},
            {358, 0.05086635222660557, 0.27445329105337574},
            {359, 0.05425119235295294, 0.27323533087874297},
            {360, 0.057635870665957274, 0.27197973527798175},
            {361, 0.061020090936612925, 0.2706870158166468},
            {362, 0.06440355912171936, 0.2693576860763126},
            {363, 0.0677859833499289, 0.26799226165620105},
            {364, 0.07116707391251148, 0.2665912601734489},
            {365, 0.0745465432545239, 0.2651552012643316},
            {366, 0.07792410596638753, 0.2636846065862698},
            {367, 0.08129947877586792, 0.2621799998204608},
            {368, 0.08467238054045895, 0.26064190667496917},
            {369, 0.08804253224016431, 0.25907085488812853},
            {370, 0.0914096569706749, 0.2574673742320984},
            {371, 0.09477347993694042, 0.255831996516429},
            {372, 0.0981337284471269, 0.2541652555914952},
            {373, 0.10149013341901207, 0.2524676863739252},
            {374, 0.10484242337610225, 0.2507398287210068},
            {375, 0.10819033336614171, 0.24898222168392892},
            {376, 0.11153359905732069, 0.24719540730325187},
            {377, 0.11487195819647082, 0.24537992967080308},
            {378, 0.11820515060523258, 0.24353633492953486},
            {379, 0.12153291817656832, 0.24166517127235862},
            {380, 0.12485500487160871, 0.23976698893985057},
            {381, 0.12817115671682897, 0.23784234021671524},
            {382, 0.13148112180154203, 0.2358917794269095},
            {383, 0.1347846502757003, 0.2339158629273257},
            {384, 0.13808149434799774, 0.2319151490999402},
            {385, 0.141371408284258, 0.22989019834233507},
            {386, 0.14465414840610308, 0.22784157305650943},
            {387, 0.14792947308988666, 0.2257698376358944},
            {388, 0.1511971427658839, 0.22367555845049608},
            {389, 0.15445691991772323, 0.2215593038300911},
            {390, 0.15770856908205133, 0.21942164404540415},
            {391, 0.16095185445632756, 0.21726315302902244},
            {392, 0.16418654941938796, 0.21508440143072796},
            {393, 0.16741242232295347, 0.21288596690647651},
            {394, 0.17062924591656145, 0.2106684272599959},
            {395, 0.17383679500410423, 0.20843236210943417},
            {396, 0.17703484804043146, 0.20617835165809487},
            {397, 0.18022318055996708, 0.20390698158395348},
            {398, 0.18340157532969162, 0.20161883540717507},
            {399, 0.18656981538121853, 0.1993144996568289},
            {400, 0.18972768580531071, 0.19699456249158848},
            {401, 0.1928749737532248, 0.19465961365529064},
            {402, 0.19601146843811804, 0.19231024442997172},
            {403, 0.19913696113650495, 0.1899470475863571},
            {404, 0.20225124518974713, 0.18757061733180094},
            {405, 0.2053541160055596, 0.18518154925566957},
            {406, 0.2084453710595198, 0.18278044027216422},
            {407, 0.21152480989656092, 0.18036788856059185},
            {408, 0.2145922334522744, 0.17794449404802024},
            {409, 0.21764744868567013, 0.1755108546288409},
            {410, 0.22069025519633628, 0.17306757684950974},
            {411, 0.22372046648225405, 0.17061525873997646},
            {412, 0.22673788993562308, 0.16815450585535363},
            {413, 0.22974233797604024, 0.16568592222163855},
            {414, 0.23273362467123038, 0.16321011298945318},
            {415, 0.2357115661678215, 0.16072768400648638},
            {416, 0.23867598069198961, 0.1582392417356234},
            {417, 0.24162668854994154, 0.15574539317077565},
            {418, 0.24456351212821184, 0.1532467457504664},
            {419, 0.24748627589375646, 0.15074390726923065},
            {420, 0.25039480548491333, 0.1482374865584798},
            {421, 0.2532889324909938, 0.1457280893349871},
            {422, 0.2561684855146869, 0.14321632568732492},
            {423, 0.25903329505894807, 0.14070280587003103},
            {424, 0.2618831995989366, 0.13818813496102317},
            {425, 0.26471803479528094, 0.13567292200942774},
            {426, 0.2675376396598178, 0.13315777465029113},
            {427, 0.2703418552765303, 0.1306433000945123},
            {428, 0.2731305247991952, 0.12813010502345865},
            {429, 0.2759034934486865, 0.12561879548210367},
            {430, 0.2786606085099269, 0.12310997677077236},
            {431, 0.28140171932847113, 0.1206042533355897},
            {432, 0.2841266773067124, 0.11810222865771619},
            {433, 0.2868353358996971, 0.1156045051414754},
            {434, 0.2895275506105402, 0.11311168400145744},
            {435, 0.2922031789854263, 0.11062436514871057},
            {436, 0.29486208060819014, 0.10814314707610667},
            {437, 0.2975041170944637, 0.10566862674299198},
            {438, 0.3001291520853796, 0.10320139945922298},
            {439, 0.302737051240826, 0.10074205876868557},
            {440, 0.30532768223223783, 0.09829119633241198},
            {441, 0.3079009147349225, 0.09584940181138979},
            {442, 0.31045662041990685, 0.09341726274917769},
            {443, 0.3129946729453019, 0.09099536445442828},
            {444, 0.3155149479471759, 0.08858428988342643},
            {445, 0.31801732302992997, 0.08618461952274924},
            {446, 0.32050167775617183, 0.08379693127215285},
            {447, 0.32296789363607975, 0.0814218003277908},
            {448, 0.32541585411625307, 0.07905979906587196},
            {449, 0.3278454445680452, 0.07671149692685748},
            {450, 0.33025655227537415, 0.07437746030030326},
            {451, 0.33264906642200764, 0.0720582524104483},
            {452, 0.33502287807831976, 0.06975443320264911},
            {453, 0.3373778801875172, 0.06746655923076039},
            {454, 0.3397139675513317, 0.06519518354555612},
            {455, 0.3420310368099587, 0.06294085558929285},
            {456, 0.34432898394345923, 0.060704123471196705},
            {457, 0.3466077165085647, 0.0584855220936988},
            {458, 0.34886712919250046, 0.05628559650589065},
            {459, 0.35110712862143845, 0.05410487795616919},
            {460, 0.35332761921560935, 0.0519438973675352},
            {461, 0.35552851508371325, 0.04980317371290457},
            {462, 0.3577097147586946, 0.047683238392984585},
            {463, 0.35987113422692213, 0.04558460309750184},
            {464, 2.010281917567749, 0.24232542854779007},
            {465, 2.0129408210850444, 0.2444281506778471},
            {466, 2.0156164517775155, 0.24650902350651488},
            {467, 2.0183086692371432, 0.24856754461365196},
            {468, 2.0210173310136557, 0.2506032164675381},
            {469, 2.0237422626475636, 0.2526155388576261},
            {470, 2.026483377470036, 0.2546040397872481},
            {471, 2.0292404969514246, 0.2565682290273204},
            {472, 2.0320134696579073, 0.25850762923789494},
            {473, 2.034802139151549, 0.2604217677203059},
            {474, 2.037606354736352, 0.26231017895277203},
            {475, 2.040425959566433, 0.264172401856964},
            {476, 2.0432607947261845, 0.26600798084874433},
            {477, 2.0461106992387874, 0.2678164659048429},
            {478, 2.048975510038024, 0.2695974126194825},
            {479, 2.051855061981547, 0.27135038226715},
            {480, 2.054749187854344, 0.2730749418604025},
            {481, 2.057657718363002, 0.27477066420332624},
            {482, 2.060580482134859, 0.27643712794340375},
            {483, 2.063517305717406, 0.2780739176208596},
            {484, 2.066468013577939, 0.2796806237154932},
            {485, 2.0694324281034353, 0.2812568426910175},
            {486, 2.0724103696006484, 0.28280217703692845},
            {487, 2.0754016562964033, 0.2843162353079251},
            {488, 2.0784061043380713, 0.2857986321609186},
            {489, 2.0814235277942186, 0.28724898838965995},
            {490, 2.084453738655407, 0.2886669309570287},
            {491, 2.087496546835129, 0.29005209302502516},
            {492, 2.0905517601708707, 0.2914041139825158},
            {493, 2.0936191844252767, 0.29272263947078164},
            {494, 2.0966986232874056, 0.2940073214069285},
            {495, 2.0997898773461703, 0.29525781793117},
            {496, 2.102892744613656, 0.296473793495168},
            {497, 2.1060070250816048, 0.29765491916258546},
            {498, 2.109132514194949, 0.2988008721499278},
            {499, 2.1122690053391784, 0.29991133603606857},
            {500, 2.1154163211635315, 0.30098600197167874}
        }
};


AngleLookupTable TopMotor = {
        .size = 262,
        .entries = {
                {238, -0.010187898341434529,  0.002161964451786413},
                {239, -0.010116012759355154,  0.008907828487363002},
                {240, -0.009957724816799098,  0.015641817147128062},
                {241, -0.009714461949637453,  0.022359412811699123},
                {242, -0.009387635257219643,  0.029056332115547916},
                {243, -0.008978639359880447,  0.03572851728750445},
                {244, -0.008488852285992759,  0.04237212765491404},
                {245, -0.007919635386554677,  0.04898353132296001},
                {246, -0.00727233327542807,   0.055559297038740595},
                {247, -0.006548273793440201,  0.06209618624795558},
                {248, -0.00574876799466532,   0.06859114535049847},
                {249, -0.004875110153321339,  0.07504129815981854},
                {250, -0.0039285777897878835, 0.08144393856965758},
                {251, -0.0029104317143682475, 0.08779652343060605},
                {252, -0.001821916087493322,  0.09409666563790799},
                {253, -0.000664258495154583,  0.10034212743102526},
                {254, 0.0005613299781102586,  0.10653081390613342},
                {255, 0.0018536546187636076,  0.11266076673486483},
                {256, 0.0032115369558676867,  0.1187301580937698},
                {257, 0.004633814680154845,   0.12473728480511857},
                {258, 0.0061193414881053594,  0.13068056267584516},
                {259, 0.007666986936306669,   0.13655852103916538},
                {260, 0.009275636287013346,   0.1423697974935744},
                {261, 0.010944190345584063,   0.14811313283546385},
                {262, 0.012671565290431236,   0.15378736618136468},
                {263, 0.014456692496050057,   0.1593914302755993},
                {264, 0.016298518349687433,   0.16492434697896596},
                {265, 0.018196004062140392,   0.17038522293394745},
                {266, 0.020148125473170592,   0.17577324540183148},
                {267, 0.02215387285196569,    0.18108767826706432},
                {268, 0.024212250693073572,   0.18632785820411216},
                {269, 0.026322277508200022,   0.1914931910020811},
                {270, 0.028482985614241667,   0.19658314804234656},
                {271, 0.030693051840644515,   0.20159725698815914},
                {272, 0.03295218669537455,    0.20653512265188914},
                {273, 0.035258756224582855,   0.21139638429555932},
                {274, 0.03761195080507179,    0.21618074862291395},
                {275, 0.04001458294354908,    0.2208879741558725},
                {276, 0.042459098710094054,   0.22551784050180176},
                {277, 0.04494795775103623,    0.23007020619802},
                {278, 0.047479382697946375,   0.23454496580594947},
                {279, 0.050054486065537314,   0.23894202759430858},
                {280, 0.052672024584973,      0.24326135020239306},
                {281, 0.05532974246574221,    0.24750295524587967},
                {282, 0.058027601262105016,   0.25166686428172197},
                {283, 0.060764792462423084,   0.2557531412574657},
                {284, 0.06354051761383439,    0.25976187994389377},
                {285, 0.066353561878249,      0.263693217138272},
                {286, 0.06920341594509175,    0.26754729515490605},
                {287, 0.07208942525319832,    0.27132428384410556},
                {288, 0.0750108384677727,     0.2750243795927443},
                {289, 0.07796691402454892,    0.27864780051238247},
                {290, 0.08095691989345691,    0.2821947850723289},
                {291, 0.08398013334373713,    0.2856655908030655},
                {292, 0.08703584071087744,    0.28906049306719067},
                {293, 0.09012333716575299,    0.2923797838951267},
                {294, 0.0932419264863367,     0.29562377088292635},
                {295, 0.09639092083236092,    0.2987927761496143},
                {296, 0.09956964052329531,    0.3018871353515743},
                {297, 0.10277741382001336,    0.30490719675158545},
                {298, 0.10601357671049967,    0.3078533203401979},
                {299, 0.10927747269995912,    0.31072587700720156},
                {300, 0.11256845260566302,    0.31352524776104435},
                {301, 0.11588587435686969,    0.3162518229941084},
                {302, 0.11922911616541078,    0.31890600054199897},
                {303, 0.12259751093322493,    0.3214881911458628},
                {304, 0.125990474267613,      0.32399880586812446},
                {305, 0.1294073908486801,     0.3264382659928081},
                {306, 0.13284765133390375,    0.32880699915489725},
                {307, 0.13631065217377317,    0.33110543884699417},
                {308, 0.1397957954350871,     0.3333340239595639},
                {309, 0.14330252164582216,    0.3354931944694929},
                {310, 0.14683099616718767,    0.3375833073150828},
                {311, 0.15037822253644642,    0.33960510776760605},
                {312, 0.15394602139189886,    0.34155876223567916},
                {313, 0.1575364286717716,     0.34344437936657457},
                {314, 0.16114216425490044,    0.34526329401635547},
                {315, 0.16476690365642338,    0.3470154199153644},
                {316, 0.16840973328984515,    0.3487012670134505},
                {317, 0.17206983874627513,    0.3503213389621195},
                {318, 0.1757467011077382,     0.35187610191263585},
                {319, 0.179439806996787,      0.3533660234826066},
                {320, 0.18314864845567919,    0.3547915725673217},
                {321, 0.18687272282878223,    0.3561532191692152},
                {322, 0.19061153264831224,    0.35745143424456494},
                {323, 0.19436458552351613,    0.3586866895665779},
                {324, 0.19813139403340085,    0.359859457604043},
                {325, 0.20191147562311162,    0.3609702114147486},
                {326, 0.20570435250405483,    0.3620194245529042},
                {327, 0.20951288799871826,    0.36300696179439024},
                {328, 0.21332998977018786,    0.36393449407012796},
                {329, 0.2171585171168515,     0.3648019012890928},
                {330, 0.22099799616439111,    0.36560966066197215},
                {331, 0.22484850846601537,    0.3663581407847518},
                {332, 0.22870788105230974,    0.36704815782376926},
                {333, 0.23257838669778466,    0.3676796415037571},
                {334, 0.23645814478745766,    0.36825335050153485},
                {335, 0.24034751742609978,    0.3687695881390178},
                {336, 0.2442443315849238,     0.36922919745721333},
                {337, 0.24814912635768172,    0.36963244948753854},
                {338, 0.25206148684812785,    0.36997981602674723},
                {339, 0.2559810024538833,     0.3702717688046366},
                {340, 0.25990726680809834,    0.37050877950994265},
                {341, 0.2638398777229789,     0.3706913198219146},
                {342, 0.26777843713515037,    0.37081986144716583},
                {343, 0.271722551052837,      0.370894876161414},
                {344, 0.27567182950483105,    0.3709168358557324},
                {345, 0.27962588649123243,    0.37088621258695},
                {346, 0.2835845351869265,     0.37080342810793127},
                {347, 0.28754723890498257,    0.3706689941568901},
                {348, 0.2915136039266436,     0.3704833883094725},
                {349, 0.29548325750997584,    0.37024708420342284},
                {350, 0.29945583036036977,    0.36996055606289613},
                {351, 0.30343095658958574,    0.36962427877443443},
                {352, 0.3074049357851191,     0.36923967876980646},
                {353, 0.3113843813440745,     0.3688052598692673},
                {354, 0.31536493821098993,    0.36832262575141594},
                {355, 0.31934828509837593,    0.3677916537310379},
                {356, 0.32333025982511454,    0.3672139551120146},
                {357, 0.32731265203541704,    0.36658938315906425},
                {358, 0.3312951223724685,     0.3659184186888738},
                {359, 0.33527733492757616,    0.36520154367216745},
                {360, 0.3392592826744328,     0.3644391367571519},
                {361, 0.34324035879273157,    0.36363176840023936},
                {362, 0.34722021926644575,    0.36277992983481405},
                {363, 0.3511985433103858,     0.3618841074187074},
                {364, 0.3551750135194492,     0.36094478898288485},
                {365, 0.3591493158521182,     0.359962463899592},
                {366, 0.3631211396152264,     0.35893762314875416},
                {367, 0.36709017744997036,    0.35787075938241575},
                {368, 0.371056125319125,      0.35676236698701663},
                {369, 0.37501868249543974,    0.35561294214330935},
                {370, 0.3789775515511729,     0.35442298288372187},
                {371, 0.38293243834873847,    0.3531929891469816},
                {372, 0.3868830520324249,     0.351923462829818},
                {373, 0.39082910502115453,    0.3506149078355702},
                {374, 0.3947703130022457,     0.34926783011952717},
                {375, 0.39870639492614224,    0.3478827377308447},
                {376, 0.4026370730020747,     0.3464601408508735},
                {377, 0.40656207269460964,    0.34500055182775824},
                {378, 0.4104811227210601,     0.34350448520715304},
                {379, 0.4143939550497026,     0.3419724577589272},
                {380, 0.4183003048987772,     0.340404988499726},
                {381, 0.42219991073621627,    0.3388025987112636},
                {382, 0.4260925142800735,     0.33716581195423473},
                {383, 0.42997786049959974,    0.33549515407773817},
                {384, 0.4338556976169321,     0.33379115322410824},
                {385, 0.4377257771093523,     0.3320543398290671},
                {386, 0.44158785371206577,    0.33028524661710856},
                {387, 0.4454416854214652,     0.3284844085920423},
                {388, 0.4492870334988296,     0.32665236302262796},
                {389, 0.45312366247441416,    0.32478964942324023},
                {390, 0.4569513401518915,     0.32289680952951627},
                {391, 0.4607698376130929,     0.32097438726894384},
                {392, 0.4645789292230068,     0.31902292872635635},
                {393, 0.4683783926349891,     0.3170429821043126},
                {394, 0.4721680087961425,     0.3150350976783477},
                {395, 0.4759475619528117,     0.3129998277470905},
                {396, 0.4797201801048418,     0.3109360394595962},
                {397, 0.48347897327219735,    0.3088476450162874},
                {398, 0.4872270760252374,     0.30673353349498256},
                {399, 0.4909642858630764,     0.3045942646884869},
                {400, 0.494690403611784,      0.3024304000868244},
                {401, 0.4984052334296545,     0.3002425027969863},
                {402, 0.49999637984145695,    0.29916431091467854},
                {403, 0.49999564416648556,    0.2989291058535245},
                {404, 0.49999494330178135,    0.29868819727461404},
                {405, 0.4999962963959059,     0.29844087947538156},
                {406, 0.4999942222499521,     0.298190467783282},
                {407, 0.4999953185146407,     0.29793376984580355},
                {408, 0.4999961675699102,     0.2976729709226889},
                {409, 0.49999367393576954,    0.2974100847441707},
                {410, 0.4999945191217606,     0.29714182264228267},
                {411, 0.4999958369375619,     0.29687004887032215},
                {412, 0.49999385753687225,    0.2965971225036997},
                {413, 0.4999955997780223,     0.2963195199928595},
                {414, 0.49999445183425284,    0.2960411341684232},
                {415, 0.49999456297164024,    0.2957599792775348},
                {416, 0.49999527175667,       0.2954766847636862},
                {417, 0.4999935611722596,     0.2951931719658713},
                {418, 0.49999384047101364,    0.2949072697297058},
                {419, 0.4999941195581947,     0.29462031726441607},
                {420, 0.49999439843727733,    0.2943325523730617},
                {421, 0.49999472813516904,    0.2940441768951828},
                {422, 0.49999517871403065,    0.29375537440808275},
                {423, 0.499995628972406,      0.2934664277437757},
                {424, 0.4999960789154826,     0.2931775455480246},
                {425, 0.4999965285483348,     0.29288892969355024},
                {426, 0.4999936371264842,     0.29260265454854795},
                {427, 0.49999408615364116,    0.2923151554382914},
                {428, 0.49999453488509815,    0.2920284896316038},
                {429, 0.49999522359949294,    0.29174269770631134},
                {430, 0.49999594872749514,    0.2914580651735311},
                {431, 0.499993332649362,      0.291176680181367},
                {432, 0.4999940568707972,     0.29089490300708337},
                {433, 0.499994895662126,      0.29061471972288616},
                {434, 0.49999606605319985,    0.2903361546818678},
                {435, 0.4999938949981969,     0.29006146267478233},
                {436, 0.49999535414289575,    0.2897867791006674},
                {437, 0.49999390379114783,    0.2895160019610097},
                {438, 0.4999965338539022,     0.28924522542213255},
                {439, 0.49999392971044954,    0.28897996625602335},
                {440, 0.4999955986960692,     0.28871483497168515},
                {441, 0.4999944739779622,     0.28845405409152736},
                {442, 0.4999944739779622,     0.2881954575082218},
                {443, 0.4999944739779622,     0.2879398097028554},
                {444, 0.4999944739779622,     0.2876872168647717},
                {445, 0.4999944739779622,     0.28743778161872036},
                {446, 0.4999944739779622,     0.2871916031473445},
                {447, 0.4999944739779622,     0.2869487773104614},
                {448, 0.4999944739779622,     0.2867093967611957},
                {449, 0.4999944739779622,     0.28647355105903133},
                {450, 0.4999944739779622,     0.28624132677984615},
                {451, 0.4999944739779622,     0.2860128076229966},
                {452, 0.4999944739779622,     0.285788074515515},
                {453, 0.4999944739779622,     0.28556720571348554},
                {454, 0.4999944739779622,     0.28535027690066306},
                {455, 0.4999944739779622,     0.28513736128440076},
                {456, 0.4999944739779622,     0.2849285296889477},
                {457, 0.4999944739779622,     0.284723850646183},
                {458, 0.4999944739779622,     0.28452339048384717},
                {459, 0.4999944739779622,     0.28432721341133405},
                {460, 0.4999944739779622,     0.2841353816031048},
                {461, 0.4999944739779622,     0.28394795527978467},
                {462, 0.4999944739779622,     0.28376499278700246},
                {463, 0.4999944739779622,     0.28358655067203287},
                {464, 0.4999944739779622,     0.28341268375829926},
                {465, 0.4999944739779622,     0.2832434452177939},
                {466, 0.4999944739779622,     0.28307888664147407},
                {467, 0.4999944739779622,     0.2829190581076885},
                {468, 0.4999944739779622,     0.28276400824868836},
                {469, 0.4999944739779622,     0.282613784315277},
                {470, 0.4999944739779622,     0.2824684322396531},
                {471, 0.4999944739779622,     0.282327996696495},
                {472, 0.4999944739779622,     0.2821925211623401},
                {473, 0.4999944739779622,     0.2820620479733084},
                {474, 0.4999944739779622,     0.2819366183812185},
                {475, 0.4999944739779622,     0.2818162726081425},
                {476, 0.4999944739779622,     0.2817010498994506},
                {477, 0.4999944739779622,     0.28159098857538484},
                {478, 0.4999944739779622,     0.28148612608121304},
                {479, 0.4999944739779622,     0.28138649903600216},
                {480, 0.4999944739779622,     0.28129214328005536},
                {481, 0.4999944739779622,     0.2812030939210549},
                {482, 0.4999944739779622,     0.2811193853789511},
                {483, 0.4999944739779622,     0.2810410514296359},
                {484, 0.4999944739779622,     0.2809681252474438},
                {485, 0.4999944739779622,     0.28090063944651267},
                {486, 0.4999944739779622,     0.28083862612104493},
                {487, 0.4999944739779622,     0.28078211688450616},
                {488, 0.4999944739779622,     0.28073114290779255},
                {489, 0.4999944739779622,     0.2806857349564042},
                {490, 0.4999944739779622,     0.2806459234266567},
                {491, 0.4999944739779622,     0.28061173838096615},
                {492, 0.4999944739779622,     0.2805832095822345},
                {493, 0.4999944739779622,     0.2805603665273702},
                {494, 0.4999944739779622,     0.28054323847997376},
                {495, 0.4999944739779622,     0.2805318545022162},
                {496, 0.4999944739779622,     0.2805262434859397},
                {497, 0.4999944739779622,     0.28052643418300965},
                {498, 0.4999944739779622,     0.2805324552349427},
                {499, 0.4999944739779622,     0.2805443352018397},
                {500, 0.4999944739779622,     0.2805621025906476}
        }
};


AngleLookupTable BottomMotor = {
        .size = 321,
        .entries = {
            { 100, -0.5707550986060282, 0.0027408290542187148 },
            { 101, -0.5701291853834967, 0.003497938325020687 },
            { 102, -0.5694692039907008, 0.00431634532392373 },
            { 103, -0.5687745408614423, 0.00519618132983634 },
            { 104, -0.5680485177487355, 0.006133653010031235 },
            { 105, -0.5672852289608793, 0.007134142571845068 },
            { 106, -0.5664890239892604, 0.008192820065688498 },
            { 107, -0.5656589483890284, 0.009310125836488251 },
            { 108, -0.5647948608284556, 0.010485683393296655 },
            { 109, -0.5638968327374784, 0.011718897748853836 },
            { 110, -0.5629648818524079, 0.013009220016844939 },
            { 111, -0.561999025594, 0.014356094472911246 },
            { 112, -0.5609992811404603, 0.01575895854043854 },
            { 113, -0.5599656655008506, 0.017217242778438283 },
            { 114, -0.5588981955888762, 0.01873037087178942 },
            { 115, -0.557796888297021, 0.02029775962411691 },
            { 116, -0.5566651021610183, 0.021915549001533703 },
            { 117, -0.555496171057215, 0.023589688045505045 },
            { 118, -0.5542934538691511, 0.025316297083082147 },
            { 119, -0.5530569681517131, 0.02709476538233274 },
            { 120, -0.5517867318133616, 0.02892447534289646 },
            { 121, -0.5504827631916293, 0.030804802509992853 },
            { 122, -0.5491450811286875, 0.0327351155927965 },
            { 123, -0.5477737050469257, 0.034714776487395314 },
            { 124, -0.5463686550244817, 0.03674314030455428 },
            { 125, -0.5449332932866108, 0.03881634884986959 },
            { 126, -0.5434609585952818, 0.040940165073178714 },
            { 127, -0.5419550148848776, 0.04311070941929985 },
            { 128, -0.5404155665298745, 0.045327233192233723 },
            { 129, -0.5388430222571152, 0.047588693998138885 },
            { 130, -0.537236961349615, 0.04989483344611974 },
            { 131, -0.5355974095041349, 0.05224496164331035 },
            { 132, -0.5339243934697058, 0.054638382509763 },
            { 133, -0.5322179411065682, 0.057074393866176985 },
            { 134, -0.53047681914488, 0.05955346806184291 },
            { 135, -0.5287034412924131, 0.0620726576823096 },
            { 136, -0.5268967055158267, 0.06463230621359481 },
            { 137, -0.5250566439272809, 0.06723168864371723 },
            { 138, -0.5231832900112234, 0.06987007439653074 },
            { 139, -0.5212766786790285, 0.07254672745440988 },
            { 140, -0.5193368463226684, 0.07526090648701045 },
            { 141, -0.5173638308673967, 0.07801186498605672 },
            { 142, -0.5153576718234081, 0.0807988514061138 },
            { 143, -0.513318410336456, 0.0836211093112716 },
            { 144, -0.5112460892374016, 0.08647787752766518 },
            { 145, -0.5091407530906735, 0.08936839030173574 },
            { 146, -0.5070024482416262, 0.09229187746412187 },
            { 147, -0.5048312228627743, 0.0952475645990607 },
            { 148, -0.5026271269989018, 0.09823467321915884 },
            { 149, -0.50039021261103, 0.10125242094538654 },
            { 150, -0.49812053361924724, 0.10430002169212442 },
            { 151, -0.49581814594439544, 0.1073766858570913 },
            { 152, -0.49348310754862235, 0.11048162051595624 },
            { 153, -0.49111547847480436, 0.11361402962143556 },
            { 154, -0.4887153208848557, 0.11677311420665452 },
            { 155, -0.4862826990969395, 0.1199580725925498 },
            { 156, -0.4838176796216042, 0.12316810059906994 },
            { 157, -0.4813203311968716, 0.12640239175992418 },
            { 158, -0.4787907248223078, 0.1296601375406223 },
            { 159, -0.47622893379211356, 0.13294052755953228 },
            { 160, -0.47363503372727683, 0.1362427498116769 },
            { 161, -0.47100910260682843, 0.1395659908949871 },
            { 162, -0.46835122079825553, 0.14290943623871458 },
            { 163, -0.46566147108712347, 0.14627227033370507 },
            { 164, -0.4629399387059671, 0.149653676964227 },
            { 165, -0.46018671136250894, 0.15305283944104786 },
            { 166, -0.4574018792672723, 0.15646894083544427 },
            { 167, -0.45458553516065514, 0.15990116421383158 },
            { 168, -0.4517377743395327, 0.1633486928726974 },
            { 169, -0.4488587946926863, 0.166810630825076 },
            { 170, -0.44594849630861644, 0.17028632279966296 },
            { 171, -0.4430081174767022, 0.1737740582532348 },
            { 172, -0.440034557599778, 0.17727554993269234 },
            { 173, -0.43703123001492544, 0.18078738196285418 },
            { 174, -0.4339971112723495, 0.18430963801315658 },
            { 175, -0.4309325705834465, 0.18784131320747952 },
            { 176, -0.42783618912433796, 0.19138277798930986 },
            { 177, -0.4247105745839015, 0.19493132043442196 },
            { 178, -0.42155505093762696, 0.1984867586795785 },
            { 179, -0.41836874640072097, 0.20204904696532328 },
            { 180, -0.41515237918910536, 0.2056169412649167 },
            { 181, -0.4119060811443384, 0.20918964812583052 },
            { 182, -0.408629987196152, 0.21276637737095386 },
            { 183, -0.4053242354049329, 0.21634634229597072 },
            { 184, -0.4019889670046915, 0.2199287598630584 },
            { 185, -0.3986243264463142, 0.22351285089086526 },
            { 186, -0.39523043660147317, 0.22709785799631263 },
            { 187, -0.39180745226423874, 0.2306830072110478 },
            { 188, -0.38835553344706386, 0.23426752772535853 },
            { 189, -0.38487483504269726, 0.2378506593745946 },
            { 190, -0.38136551505748, 0.24143164690555188 },
            { 191, -0.37782773463236186, 0.24500974014878102 },
            { 192, -0.3742616580621145, 0.24858419418671493 },
            { 193, -0.3706674528123435, 0.25215426951767006 },
            { 194, -0.3670452895338549, 0.25571923221580645 },
            { 195, -0.3633953420738924, 0.25927835408713656 },
            { 196, -0.35971778748371336, 0.2628309128217072 },
            { 197, -0.3560128060219271, 0.26637619214208424 },
            { 198, -0.35228058115298205, 0.2699134819482876 },
            { 199, -0.3485212995401457, 0.27344207845933194 },
            { 200, -0.34473515103229047, 0.27696128435153566 },
            { 201, -0.34091899025373756, 0.28047254455013243 },
            { 202, -0.3370796901935407, 0.28397088708387247 },
            { 203, -0.3332141116586857, 0.28745778714211234 },
            { 204, -0.32932168259586153, 0.29093305839762656 },
            { 205, -0.32540317020972237, 0.2943956779946426 },
            { 206, -0.3214588906176372, 0.2978449206496417 },
            { 207, -0.31748900543355985, 0.3012801665637475 },
            { 208, -0.3134937152622978, 0.3047007805259433 },
            { 209, -0.30947322307568503, 0.30810613484370736 },
            { 210, -0.30542773419013297, 0.3114956093966342 },
            { 211, -0.3013574562439541, 0.31486859168258413 },
            { 212, -0.2972625991745018, 0.31822447685635913 },
            { 213, -0.29314337519517436, 0.32156266776092957 },
            { 214, -0.2889999987723248, 0.32488257495123274 },
            { 215, -0.2848326866021123, 0.32818361671058843 },
            { 216, -0.2806416575873287, 0.3314652190597787 },
            { 217, -0.276427132814224, 0.3347268157588567 },
            { 218, -0.2721893355293479, 0.33796784830175886 },
            { 219, -0.26792849111641626, 0.34118776590380456 },
            { 220, -0.26364482707319553, 0.3443860254821864 },
            { 221, -0.2593385729883935, 0.3475620916295578 },
            { 222, -0.25500996051852076, 0.3507154365808415 },
            { 223, -0.25065922336467866, 0.35384554017339753 },
            { 224, -0.24628659724920576, 0.35695188980069453 },
            { 225, -0.24189231989209456, 0.3600339803596501 },
            { 226, -0.23747666178765892, 0.3630912981684834 },
            { 227, -0.23303980045104628, 0.3661233864363937 },
            { 228, -0.2285820129002236, 0.3691297446431283 },
            { 229, -0.22410354471794078, 0.3721098969950486 },
            { 230, -0.2196046433936344, 0.37506337483456076 },
            { 231, -0.21508555830449924, 0.37798971654964747 },
            { 232, -0.21054654069707288, 0.3808884674777221 },
            { 233, -0.20598788919737526, 0.3837591575185295 },
            { 234, -0.20140989947292945, 0.3866013264153113 },
            { 235, -0.19681275508588805, 0.38941457601619145 },
            { 236, -0.1921967129842093, 0.3921984793027182 },
            { 237, -0.1875620318031126, 0.394952615662142 },
            { 238, -0.18290897186762492, 0.3976765707505798 },
            { 239, -0.17823779519713592, 0.4003699363513984 },
            { 240, -0.17354876551188828, 0.4030323102290381 },
            { 241, -0.16884214824130864, 0.40566329597849904 },
            { 242, -0.16411821053407713, 0.4082625028707103 },
            { 243, -0.1593738855725823, 0.4108310410213089 },
            { 244, -0.15461611544557685, 0.4133655267609433 },
            { 245, -0.14984183676783688, 0.4158670940240123 },
            { 246, -0.1450513236959709, 0.4183353731647921 },
            { 247, -0.14024485217754523, 0.4207699993862864 },
            { 248, -0.1354226999685812, 0.423170612565531 },
            { 249, -0.13058514665167806, 0.425536857076305 },
            { 250, -0.12573247365456425, 0.4278683816094507 },
            { 251, -0.12086496426887315, 0.4301648389909979 },
            { 252, -0.11598290366893226, 0.4324258859982874 },
            { 253, -0.11108807322186401, 0.43465056977451 },
            { 254, -0.1061757556411189, 0.4368406076194552 },
            { 255, -0.10125322516524564, 0.4389928126974084 },
            { 256, -0.09631489154045905, 0.44110924487738645 },
            { 257, -0.09136438102342816, 0.44318823209620484 },
            { 258, -0.08640108929839635, 0.4452298145733534 },
            { 259, -0.08142460416661718, 0.4472339486115408 },
            { 260, -0.07643859456103314, 0.44919900825351583 },
            { 261, -0.07143690371192307, 0.4511271769044148 },
            { 262, -0.06642655268193227, 0.4530155539886328 },
            { 263, -0.0614033701585983, 0.4548655409482452 },
            { 264, -0.056369688645525697, 0.45667605726135757 },
            { 265, -0.05132534058318063, 0.45844697531229484 },
            { 266, -0.046270633900913495, 0.4601779890046278 },
            { 267, -0.041205879268885644, 0.4618687929773788 },
            { 268, -0.03613138999355978, 0.4635190824562135 },
            { 269, -0.031047480538486414, 0.4651285535926042 },
            { 270, -0.02595446727546878, 0.46669690298477445 },
            { 271, -0.020852668518792947, 0.4682238274636751 },
            { 272, -0.015742404559949692, 0.46970902387876157 },
            { 273, -0.010623997702715519, 0.4711521888836845 },
            { 274, -0.005497772298468109, 0.4725530187219832 },
            { 275, -0.00036405478161209134, 0.47391120901288086 },
            { 276, 0.004776826294996886, 0.4752264545372631 },
            { 277, 0.00992454022473786, 0.47649844902392646 },
            { 278, 0.015078754112115615, 0.4777268849361692 },
            { 279, 0.02023913283794035, 0.478911453258796 },
            { 280, 0.02540533902486479, 0.48005184328559924 },
            { 281, 0.030577033003334413, 0.4811477424073789 },
            { 282, 0.035753631689119166, 0.48219875869329626 },
            { 283, 0.04093430957335161, 0.483204424190735 },
            { 284, 0.046122007229069145, 0.484165460421735 },
            { 285, 0.05131048532458182, 0.4850796849906452 },
            { 286, 0.05650606190289183, 0.4859488647984096 },
            { 287, 0.06170297535338375, 0.4867709841028155 },
            { 288, 0.06690327353574986, 0.4875464596163421 },
            { 289, 0.07210625292477243, 0.48827484927806597 },
            { 290, 0.07731155154488063, 0.4889558138733404 },
            { 291, 0.08251880464430741, 0.4895890101570197 },
            { 292, 0.08772764464595251, 0.4901740906468481 },
            { 293, 0.09293770109791903, 0.490710703418067 },
            { 294, 0.09814860062361266, 0.49119849189930725 },
            { 295, 0.10335996687125983, 0.4916370946698038 },
            { 296, 0.10857142046266659, 0.49202614525800376 },
            { 297, 0.11378257672378027, 0.49236527131360575 },
            { 298, 0.11899305100899246, 0.49265409594533793 },
            { 299, 0.12420245541780678, 0.49289223658806264 },
            { 300, 0.1294103977622772, 0.49307930453868065 },
            { 301, 0.13461648252021768, 0.49321490505184046 },
            { 302, 0.13982031076665713, 0.4932986371464525 },
            { 303, 0.14502082615330578, 0.4933299170023537 },
            { 304, 0.15021958457140516, 0.4933088598276218 },
            { 305, 0.1554142145900598, 0.49323451555546516 },
            { 306, 0.16060495684867093, 0.4931066327728222 },
            { 307, 0.16579139422392292, 0.49292477647883237 },
            { 308, 0.17097310567830418, 0.49268850431456085 },
            { 309, 0.17614966615388722, 0.4923973663837751 },
            { 310, 0.18132064645888898, 0.49205090507649984 },
            { 311, 0.18648561314658038, 0.49164865489560705 },
            { 312, 0.19164412838613604, 0.49119014228673863 },
            { 313, 0.19679574982505194, 0.49067488547189203 },
            { 314, 0.2019400304427975, 0.49010239428704083 },
            { 315, 0.20707318199065353, 0.48947135513348855 },
            { 316, 0.2122014203701031, 0.4887828972970752 },
            { 317, 0.21732094725848214, 0.4880356827174543 },
            { 318, 0.22243129531618175, 0.4872291861623516 },
            { 319, 0.22753199166526084, 0.4863628732784188 },
            { 320, 0.23262212804996657, 0.4854360999785454 },
            { 321, 0.23770153756786727, 0.48444838959999453 },
            { 322, 0.2427694416134773, 0.483399114257447 },
            { 323, 0.2478259863294311, 0.482287850869259 },
            { 324, 0.25287039047928295, 0.48111395363766607 },
            { 325, 0.2579021456426913, 0.479876831837702 },
            { 326, 0.2629207367974864, 0.4785758850309272 },
            { 327, 0.2679256421548786, 0.47721050302758117 },
            { 328, 0.2729165080324946, 0.4757801038817683 },
            { 329, 0.2778927657064651, 0.4742840496567131 },
            { 330, 0.28285362027340616, 0.47272164629250085 },
            { 331, 0.2877985219728638, 0.47109224537424776 },
            { 332, 0.29272691496433695, 0.469395189103669 },
            { 333, 0.2976382370622745, 0.46762981032909395 },
            { 334, 0.302531451229122, 0.4657953369454637 },
            { 335, 0.30740722054380637, 0.4638913366926143 },
            { 336, 0.3122642769699959, 0.46191697270468063 },
            { 337, 0.31710202229679024, 0.4598715390053452 },
            { 338, 0.3219198498221226, 0.45775432067373933 },
            { 339, 0.32671714420073444, 0.4555645940606015 },
            { 340, 0.33149328129165256, 0.4533016270345708 },
            { 341, 0.33624762800471064, 0.45096467926036926 },
            { 342, 0.34097954214561177, 0.4485530025107367 },
            { 343, 0.3456883722589977, 0.4460658410140777 },
            { 344, 0.3503734574689623, 0.4435024318399082 },
            { 345, 0.3550307887170862, 0.4408614091295301 },
            { 346, 0.35966636292467985, 0.43814319775977756 },
            { 347, 0.3642761514326984, 0.43534641156753034 },
            { 348, 0.3688594540164551, 0.43247026368354335 },
            { 349, 0.3734155601742838, 0.4295139626558194 },
            { 350, 0.3779437489403646, 0.4264767131129192 },
            { 351, 0.3824432886909975, 0.4233577164834908 },
            { 352, 0.38691343694387625, 0.4201561717752949 },
            { 353, 0.391353440149983, 0.41687127641718985 },
            { 354, 0.395762533477805, 0.4135022271677291 },
            { 355, 0.40014035855411806, 0.41004828434163765 },
            { 356, 0.4044853065270152, 0.4065085208630707 },
            { 357, 0.40879700087379384, 0.4028822028052116 },
            { 358, 0.4130746279326644, 0.3991685344074789 },
            { 359, 0.4173173612448671, 0.3953667248886209 },
            { 360, 0.42152436133186016, 0.3914759898541661 },
            { 361, 0.425694775473224, 0.3874955528024707 },
            { 362, 0.429827737485544, 0.3834246467344743 },
            { 363, 0.4339223675025753, 0.37926251587245646 },
            { 364, 0.437977771757015, 0.37500841749328767 },
            { 365, 0.44199304236424963, 0.3706616238818719 },
            { 366, 0.4459672571084761, 0.3662214244106562 },
            { 367, 0.44989947923163837, 0.36168712775129014 },
            { 368, 0.453788757225662, 0.35705806422469116 },
            { 369, 0.4576328479431453, 0.35233345715504943 },
            { 370, 0.46143326276644336, 0.3475129493611533 },
            { 371, 0.4651877940113133, 0.3425958224339166 },
            { 372, 0.4688954298436494, 0.33758151979962414 },
            { 373, 0.4725551426712758, 0.33246952057366436 },
            { 374, 0.4761658889646452, 0.3272593428815098 },
            { 375, 0.47972755140782136, 0.3219506195079823 },
            { 376, 0.4832367026752723, 0.3165427750407622 },
            { 377, 0.4866936382861297, 0.31103557960829614 },
            { 378, 0.4900971366038834, 0.30542873793420366 },
            { 379, 0.49344668101102274, 0.29972205665579077 },
            { 380, 0.4967413860437, 0.2939153746960829 },
            { 381, 0.4999787922270871, 0.28800852102043983 },
            { 382, 0.4999944739779622, 0.2818733967728185 },
            { 383, 0.4999944739779622, 0.2756768278187314 },
            { 384, 0.4999944739779622, 0.26942012725584996 },
            { 385, 0.4999944739779622, 0.26310392795448884 },
            { 386, 0.4999944739779622, 0.2567289086386047 },
            { 387, 0.4999944739779622, 0.25029579536160407 },
            { 388, 0.4999944739779622, 0.24380536305811804 },
            { 389, 0.4999944739779622, 0.23725843717539755 },
            { 390, 0.4999944739779622, 0.23065589538795106 },
            { 391, 0.4999944739779622, 0.223998669399026 },
            { 392, 0.4999944739779622, 0.2172877468324713 },
            { 393, 0.4999944739779622, 0.21052417321844777 },
            { 394, 0.4999944739779622, 0.20370905407635687 },
            { 395, 0.4999944739779622, 0.19684355709822796 },
            { 396, 0.4999944739779622, 0.1899289144356673 },
            { 397, 0.4999944739779622, 0.18296642509327632 },
            { 398, 0.4999944739779622, 0.1759574574312531 },
            { 399, 0.4999944739779622, 0.1689034517796296 },
            { 400, 0.4999944739779622, 0.1618059231663268 },
            { 401, 0.4999944739779622, 0.15466646416088137 },
            { 402, 0.4999944739779622, 0.14748674783533094 },
            { 403, 0.4999944739779622, 0.14026853084333438 },
            { 404, 0.4999944739779622, 0.133013656618144 },
            { 405, 0.4999944739779622, 0.12572405868952105 },
            { 406, 0.4999944739779622, 0.11840176411912487 },
            { 407, 0.4999944739779622, 0.1110488970532607 },
            { 408, 0.4999944739779622, 0.10366768239117703 },
            { 409, 0.4999944739779622, 0.09626044956633274 },
            { 410, 0.4999944739779622, 0.08882963643721038 },
            { 411, 0.4999944739779622, 0.08137779328333099 },
            { 412, 0.4999944739779622, 0.07390758690112392 },
            { 413, 0.4999944739779622, 0.06642180479321418 },
            { 414, 0.4999944739779622, 0.058923359443510105 },
            { 415, 0.4999944739779622, 0.0514152926692017 },
            { 416, 0.4999944739779622, 0.04390078003940044 },
            { 417, 0.4999944739779622, 0.03638313534868665 },
            { 418, 0.4999944739779622, 0.028865815132241627 },
            { 419, 0.4999944739779622, 0.021352423207560287 },
            { 420, 0.4999944739779622, 0.013846715225942679 },
            { 421, 0.4999944739779622, 0.006352603215056717 }
        }
    };

AngleLookupTable* tables[3] = {&BodyMotor, &TopMotor, &BottomMotor};


float* get_leg_position(float* angles, float* position){
    float s_0 = sinf(angles[0]);
    float c_0 = cosf(angles[0]);
    float s_1 = sinf(angles[1]);
    float c_1 = cosf(angles[1]);
    float s_2 = sinf(angles[2]);
    float c_2 = cosf(angles[2]);
    position[0] = -15.0*c_1*s_0 + 75.0*c_1 - 32.0*c_2*s_0 - 75.0*s_0*s_1 - 66.0*s_0 - 15.0*s_1 - 32.0*s_2 + 42.0;
    position[1] = 15.0*c_0*c_1 + 32.0*c_0*c_2 + 75.0*c_0*s_1 + 66.0*c_0 + 75.0*c_1*s_0 - 15.0*s_0*s_1 - 32.0*s_0*s_2 + 42.0;
    position[2] = -75.0*c_1 + 15.0*s_1 + 32.0*s_2;
    return position;
}


float** get_leg_jacobian(float* angles, float** jacobian){
    float s_0 = sinf(angles[0]);
    float c_0 = cosf(angles[0]);
    float s_1 = sinf(angles[1]);
    float c_1 = cosf(angles[1]);
    float s_2 = sinf(angles[2]);
    float c_2 = cosf(angles[2]);
    jacobian[0][0] = -15.0*c_0*c_1 - 32.0*c_0*c_2 - 75.0*c_0*s_1 - 66.0*c_0;
    jacobian[0][1] = -75.0*c_1*s_0 - 15.0*c_1 + 15.0*s_0*s_1 - 75.0*s_1;
    jacobian[0][2] = -32.0*c_2 + 32.0*s_0*s_2;
    jacobian[1][0] = 75.0*c_0*c_1 - 15.0*c_0*s_1 - 32.0*c_0*s_2 - 15.0*c_1*s_0 - 32.0*c_2*s_0 - 75.0*s_0*s_1 - 66.0*s_0;
    jacobian[1][1] = 75.0*c_0*c_1 - 15.0*c_0*s_1 - 15.0*c_1*s_0 - 75.0*s_0*s_1;
    jacobian[1][2] = -32.0*c_0*s_2 - 32.0*c_2*s_0;
    jacobian[0][0] = 0;
    jacobian[0][1] = 15.0*c_1 + 75.0*s_1;
    jacobian[0][2] = 32.0*c_2;
    return jacobian;
}


float get_jacobian_determinant(float* angles){
    float s_0 = sinf(angles[0]);
    float c_0 = cosf(angles[0]);
    float s_1 = sinf(angles[1]);
    float c_1 = cosf(angles[1]);
    float s_2 = sinf(angles[2]);
    float c_2 = cosf(angles[2]);
    float out = -18.0*c_0*(1.0*c_0*(0.2*c_1 + 0.426666666666667*c_2 + 1.0*s_1 + 0.88) - 1.0*s_0*(1.0*c_1 - 0.2*s_1 - 0.426666666666667*s_2))*(1.0*c_2*(1.0*c_1 - 0.2*s_1) + 1.0*s_2*(0.2*c_1 + 1.0*s_1)) - 18.0*s_0*(1.0*c_2*(1.0*c_1 - 0.2*s_1) + 1.0*s_2*(0.2*c_1 + 1.0*s_1))*(0.2*c_1 + 0.426666666666667*c_2 + 1.0*s_1 + 0.88);
    return out;
}


int lookup_by_pwm(AngleLookupTable* table, int pwm){

    int offset = pwm - table->entries[0].pwm;
    if ((offset < 0 ) || (offset >=table->size))
        return -1;
    return offset;
}

int lookup_by_value(AngleLookupTable* table, float value){
    if ((value <= table->entries[0].value) || value >= table->entries[table->size - 1].value)
        return -1;

    int low = 0;
    int high = table->size - 1;
    int mid;

    while (low < high){
        mid = (low + high + 1) / 2;
        if (value < table->entries[mid].value){
            high = mid;
        } else {
            low = mid;
        }
    }
    return mid;
}

bool pwm_to_angles(u8* pwm_values, float* angles){

    int index;

    for (int i=0; i<3; i++){
        if ((index = lookup_by_pwm( tables[i], pwm_values[i])) <0)
            return false;
        angles[i] = tables[i]->entries[index].value;
    }
    return true;
}

bool pwm_to_grads(u8* pwm_values, float* grads){
    int index;

    for (int i=0; i<3; i++){
        if ((index = lookup_by_pwm( tables[i], pwm_values[i])) <0)
            return false;
        grads[i] = tables[i]->entries[index].grad;
    }
    return true;
}

bool values_to_pwm(float* angles, u8* pwm_values){
    int index;

    for (int i=0; i<3; i++){
        if ((index = lookup_by_value( tables[i], angles[i])) <0)
            return false;
        pwm_values[i] = tables[i]->entries[index].pwm;
    }
    return true;

}


bool forward_leg_kinematics(u8* pwm_values, float* position){
    float angles[3];
    if (!pwm_to_angles(pwm_values, angles))
        return false;

    get_leg_position(angles, position);
}



#define vec3_isubs(x, y) x[0]-=y[0]; x[1]-=y[1]; x[2]-=y[2]
#define vec3_norm_sqr(x) x[0]*x[0] + x[1]*x[1] + x[2]*x[2]
#define vec3_iadd(x, y) x[0]+=y[0]; x[1]+=y[1]; x[2]+=y[2]

bool inverse_leg_kinematics(float* x_desired, u8* pwm_values, float tol, int max_steps){

    float eps = 0.001;
    float error[3];
    float angles[3];
    float jacobian[3][3];

    float b[3];

    int P[4];
    float grads[3];
    short delta_pwm[3];

    for (int step=0;step < max_steps; step++){

        if (!forward_leg_kinematics(pwm_values, error)){
            return false; // failed to solve forward problem
        }
        vec3_isubs(error, x_desired);
        if (vec3_norm_sqr(error) < tol)                     return true;
        if (!pwm_to_angles(pwm_values, angles))             return false;
        if (!get_leg_jacobian(angles, jacobian))            return false;
        if (!pwm_to_grads(pwm_values, grads))               return false;

        for (int row=0; row<3; row++){
            for (int col=0; col < 3; col++){
                jacobian[row][col] *=  grads[col];
            }
        }
        if (!LUPDecompose(jacobian, 3, eps, P))         return false; // failed to converge
        LUPSolve(jacobian, P, error, 3, b);
        vec3_iadd(angles, b);
        if (!values_to_pwm(angles, pwm_values))             return false;
    }
    return false;

}


